{% extends 'base.html' %}
{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }} mt-3">{{ message }}</div>
{% endfor %}
{% endif %}
{% endwith %}
<h2 class="mb-4">Latest Articles</h2>
<div class="d-flex flex-column gap-3">
    {% for article in articles %}
    <div class="card article-card flex-row align-items-center p-2">
        {% if article.thumbnail_url %}
        <img src="{{ article.thumbnail_url }}" alt="Thumbnail" class="article-thumb me-3"
            style="width:100px;height:100px;object-fit:cover;">
        {% else %}
        <div class="bg-light text-muted d-flex align-items-center justify-content-center article-thumb me-3"
            style="width:100px;height:100px;">No image</div>
        {% endif %}
        <div class="flex-grow-1">
            <div class="card-body py-2 px-2">
                <h5 class="card-title mb-1"><a href="{{ url_for('article_detail', article_id=article.id) }}"
                        class="text-decoration-none">{{ article.title }}</a></h5>
                <p class="card-text mb-1"><small class="text-muted">{{ article.summary or 'No summary available.'
                        }}</small></p>
                <div class="d-flex flex-wrap align-items-center mt-2">
                    <span class="badge bg-secondary me-2">{{ article.source }}</span>
                    <span class="text-muted me-2"><i class="bi bi-calendar"></i> {{ article.published_date or 'Unknown'
                        }}</span>
                    <span class="text-primary fw-bold me-2" data-bs-toggle="tooltip" data-bs-placement="top"
                        title="{{ article.matched_words }}">Score: {{ '%.2f'|format(article.score) }}</span>
                    <a href="{{ article.url }}" class="btn btn-link btn-sm p-0 ms-2" target="_blank"
                        rel="noopener noreferrer">Original <i class="bi bi-box-arrow-up-right"></i></a>
                    {% if username == 'admin' %}
                    <form method="post" action="{{ url_for('admin_delete_article', article_id=article.id) }}"
                        class="ms-2" style="display:inline-block;">
                        <button type="submit" class="btn btn-outline-danger btn-sm"
                            onclick="return confirm('Delete this article?');">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
{% endblock %}